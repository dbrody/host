#!/usr/bin/env ruby

$: << File.expand_path(File.join(File.dirname(__FILE__), "..", "lib"))
$: << File.expand_path(File.join(File.dirname(__FILE__), "..", "web"))

require 'eventmachine'
require 'sinatra/async'

require 'maestro_web'
require 'progenitor/udp_broadcaster'

PORT = 8833
server = Progenitor::MaestroServer.new(PORT)
broadcaster = Progenitor::UdpBroadcaster.new(PORT)
EM::run do
  server.start
  MyApp.run!

  EventMachine.add_periodic_timer(5) do
    broadcaster.go
  end
end

